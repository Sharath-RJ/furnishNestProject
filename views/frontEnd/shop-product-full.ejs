<%- include('../partials/customer/header.ejs') %>
    <main class="main">
        <div class="page-header breadcrumb-wrap">
            <div class="container">
                <!-- <div class="breadcrumb">
                    <a href="index.html" rel="nofollow">Home</a>
                    <span></span> Fashion
                    <span></span> Abstract Print Patchwork Dress
                </div> -->
            </div>
        </div>
        <section class="mt-50 mb-50">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="product-detail accordion-detail">
                            <div class="row mb-50">
                                <div class="col-md-6 col-sm-12 col-xs-12">
                                    <div class="detail-gallery">
                                        <span class="zoom-icon"><i class="fi-rs-search"></i></span>
                                        <!-- MAIN SLIDES -->
                                        <div class="product-image-slider">
                                            <% productDetails.productImage.forEach(imgs=> { %>
                                                <!-- <div style="width:400px; height: 400px; " >
                                                        <img class="zoom-image" style="width: 100%; height: 100%;" id="myimage" src="/backEnd/images/cropped_image/<%#= imgs %>" alt="product image">
                                                    </div> -->
                                                <div class="product-img--main" data-scale="1.3">
                                                    <img src="/backEnd/images/cropped_image/<%= imgs %>" width="100%"
                                                        height="100%" alt="Image 1">
                                                </div>
                                                <%}) %>
                                        </div>
                                        <!-- THUMBNAILS -->
                                        <div class="slider-nav-thumbnails pl-15 pr-15">
                                            <% productDetails.productImage.forEach(imgs=> { %>
                                                <div><img src="/backEnd/images/cropped_image/<%= imgs %>"
                                                        alt="product image"></div>
                                                <% }) %>
                                        </div>
                                    </div>
                                    <!-- End Gallery -->
                                </div>
                                <div class="col-md-6 col-sm-12 col-xs-12">
                                    <div class="detail-info" id="myresult">
                                        <h2 class="title-detail">
                                            <%= productDetails.productName %>
                                        </h2>
                                        <div class="product-detail-rating">
                                            <div class="pro-details-brand">
                                                <span> Category: <a href="#">
                                                        <%= productDetails.productCategory %>
                                                    </a></span>
                                            </div>
                                            <div class="product-rate-cover text-end">
                                                <div class="product-rate d-inline-block">
                                                    <div class="product-rating" style="width:90%">
                                                    </div>
                                                </div>
                                                <span class="font-small ml-5 text-muted"> (25 reviews)</span>
                                            </div>
                                        </div>
                                        <div class="clearfix product-price-cover">
                                            <div class="product-price primary-color float-left">
                                                <ins><span class="text-brand">₹ <%= productDetails.sellingPrice %>
                                                            </span></ins>
                                                <ins><span class="old-price font-md ml-15">₹ <%=productDetails.regularPrice %></span></ins>
                                                <span class="save-price  font-md color3 ml-15">25% Off</span>
                                            </div>
                                        </div>
                                        <div class="bt-1 border-color-1 mt-15 mb-15"></div>
                                        <div class="short-desc mb-30">
                                            <p>
                                                <%= productDetails.productDescription %>
                                            </p>
                                        </div>
                                        <div class="product_sort_info font-xs mb-30">
                                            <ul>
                                                <li class="mb-10"><i class="fi-rs-crown mr-5"></i> 1 Year AL Jazeera
                                                    Brand Warranty</li>
                                                <li class="mb-10"><i class="fi-rs-refresh mr-5"></i> 30 Day Return
                                                    Policy</li>
                                                <li><i class="fi-rs-credit-card mr-5"></i> Cash on Delivery available
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="bt-1 border-color-1 mt-30 mb-30"></div>
                                        <div class="detail-extralink">
                                            <!-- <div class="detail-qty border radius">
                                                <a href="#" class="qty-down"><i class="fas fa-angle-down"></i></a>
                                                <span class="qty-val">1</span>
                                                <a href="#" class="qty-up"><i class="fas fa-angle-up"></i></a>
                                            </div> -->
                                            <div class="product-extra-link2">
                                                <a onclick="updateCartCount('<%= productDetails._id %>')"> <button
                                                        type="submit" id="add-to-cart"
                                                        class="button button-add-to-cart">
                                                        Add to cart
                                                    </button></a>
                                                      <a  id="action-btn_<%=product._id%>"
                                                                class="action-btn hover-up link"
                                                                onclick="addToWishList('<%= product._id %>')">
                                                                <i id="heart_<%= product._id %>" class="fas fa-heart" ></i>
                                                            </a>
                                                    
                                            </div>
                                        </div>
                                        <ul class="product-meta font-xs color-grey mt-50">
                                            <!-- <li class="mb-5">SKU: <a href="#">FWM15VKT</a></li>
                                            <li class="mb-5">Tags: <a href="#" rel="tag">Cloth</a>, <a href="#"
                                                    rel="tag">Women</a>, <a href="#" rel="tag">Dress</a> </li> -->
                                            <% if (productDetails.productStock>=1) { %>
                                                <li>Availability:<span class="in-stock text-success ml-5">
                                                        <%= productDetails.productStock %> Items In
                                                            Stock
                                                    </span></li>
                                                <% }else{%>
                                                    <span class="in-stock text-danger ml-5">No Stock Available</span>
                                                    <script>
                                                        document.getElementById('add-to-cart').disabled = true
                                                        document.getElementById('add-to-cart').style.textDecoration = "line-through"
                                                    </script>
                                                    <% } %>
                                        </ul>
                                    </div>
                                    <!-- Detail Info -->
                                </div>
                            </div>
                            <div class="row mt-60">
                                <div class="col-12">
                                    <h3 class="section-title style-1 mb-30">Related products</h3>
                                </div>
                                <div class="col-12">
                                    <div class="row related-products">
                                        <% for( product of relatedProducts ) { %>
                                            <div class="col-lg-3 col-md-4 col-12 col-sm-6">
                                                <div class="product-cart-wrap small hover-up">
                                                    <div class="product-img-action-wrap">
                                                        <div class="product-img product-img-zoom">
                                                            <a href="#" tabindex="0">
                                                                <img class="default-img"
                                                                    src="/backEnd/images/cropped_image/<%= product.productImage[0] %>"
                                                                    alt="">
                                                                <img class="hover-img"
                                                                    src="/backEnd/images/cropped_image/<%= product.productImage[1] %>"
                                                                    alt="">
                                                            </a>
                                                        </div>
                                                        <div class="product-action-1">
                                                            <a aria-label="Quick view" class="action-btn small hover-up"
                                                                data-bs-toggle="modal"
                                                                data-bs-target="#quickViewModal"><i
                                                                    class="fi-rs-search"></i></a>
                                                            <a aria-label="Add To Wishlist"
                                                                class="action-btn small hover-up"
                                                                href="#" tabindex="0"><i
                                                                    class="fas fa-heart"></i></a>
                                                            <a aria-label="Compare" class="action-btn small hover-up"
                                                                href="#" tabindex="0"><i
                                                                    class="fas fa-balance-scale"></i></a>
                                                        </div>
                                                        <div
                                                            class="product-badges product-badges-position product-badges-mrg">
                                                            <span class="hot">Hot</span>
                                                        </div>
                                                    </div>
                                                    <div class="product-content-wrap">
                                                        <h2><a href="#" tabindex="0">
                                                                <%= product.productName %>
                                                            </a></h2>
                                                        <div class="rating-result" title="90%">
                                                            <span>
                                                            </span>
                                                        </div>
                                                        <div class="product-price">
                                                            <span>₹ <%= product.sellingPrice %></span>
                                                            <span class="old-price">₹ <%= product.regularPrice %></span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <%} %>
                                    </div>
                                </div>
                            </div>
                            <div
                                class="banner-img banner-big wow fadeIn d-flex justify-content-center f-none animated mt-50">
                                <img class="border-radius-10" src="/frontEnd/images/banner/offer5.jpg" alt="">
                                <div class="banner-text">
                                    <h4 class="mb-15 mt-40" style="color: yellow;">Unlock Comfort and Style:</h4>
                                    <h2 class="fw-600 mb-20" style="color: yellow;"> Our Furniture Deals Await!</h2>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <script>
        async function updateCartCount(id) {
                try {
                    const response = await fetch(`/addToCart?id=${id}`);
                    const data = await response.json();

                    console.log(data);

                    if (data.message === "Out of Stock") {
                        alert("Out of stock");
                    } else {
                        document.getElementById(`cart_${id}`).setAttribute("aria-label", "Added to cart");
                        document.getElementById("cart-count").innerHTML = data.length;
                    }
                } catch (error) {
                    console.error(error.message);
                }
            }
        const productImages = document.querySelectorAll('.product-img--main');
        productImages.forEach((image) => {
            const imageElement = image.querySelector('img');
            imageElement.style.transformOrigin = 'center center'; // Set initial transform-origin
            const scaleValue = image.getAttribute('data-scale');
            image.addEventListener('mouseover', () => {
                imageElement.style.transform = `scale(${scaleValue})`;
            });
            image.addEventListener('mouseout', () => {
                imageElement.style.transform = 'scale(1)';
            });
            image.addEventListener('mousemove', (e) => {
                const rect = image.getBoundingClientRect();
                const x = (e.clientX - rect.left) / rect.width;
                const y = (e.clientY - rect.top) / rect.height;
                imageElement.style.transformOrigin = `${x * 100}% ${y * 100}%`;
            });
        });

         function addToWishList(id) {

                $.ajax({
                    type: 'GET',
                    url: `/addToWishList?id=${id}`, // Route on the server to handle adding to the wishlist
                    success: function (response) {
                        if (response.response === 'Added') {
                            // Heart color to red
                            document.getElementById(`heart_${id}`).style.color = 'red';


                            // Hover effect
                            document.getElementById(`action-btn_${id}`).addEventListener("mouseover", () => {
                                document.getElementById(`heart_${id}`).style.color = "red";

                            });
                            document.getElementById('wish_list_count').innerHTML = response.count + 1

                            // Update ARIA label and button class
                            document.getElementById(`action-btn_${id}`).classList.remove('changeColor');
                            document.getElementById(`action-btn_${id}`).setAttribute("aria-label", "Added to WishList");
                            document.getElementById(`action-btn_${id}`).classList.add('changeColorRed');
                        } else if (response.response === "alreadyAdded") {
                            // Handle removal from wishlist here (similar logic as in your code)
                            fetch(`/removeWishList?id=${id}`)
                                .then((res) => res.json())
                                .then((data) => {
                                    if (data.response === "removed") {
                                        // Heart color to default dark green
                                        document.getElementById(`heart_${id}`).style.color = '#088178';

                                        // Hover effect for default state
                                        document.getElementById(`action-btn_${id}`).addEventListener("mouseover", () => {
                                            document.getElementById(`heart_${id}`).style.color = "white";

                                        });
                                        document.getElementById('wish_list_count').innerHTML = data.count - 1
                                        // Update ARIA label and button class
                                        document.getElementById(`action-btn_${id}`).classList.remove('changeColorRed');
                                        document.getElementById(`action-btn_${id}`).classList.add('changeColor');
                                        document.getElementById(`action-btn_${id}`).setAttribute("aria-label", "Add to wishList");
                                    }
                                });
                        }
                    },
                    error: function (error) {
                        // Handle other errors, if any
                    }
                });


            }
        $('.product-img--main')
                // tile mouse actions
                .on('mouseover', function () {
                    $(this).children('.product-img--main__image').css({ 'transform': 'scale(' + $(this).attr('data-scale') + ')' });
                })
                .on('mouseout', function () {
                    $(this).children('.product-img--main__image').css({ 'transform': 'scale(1)' });
                })
                .on('mousemove', function (e) {
                    $(this).children('.product-img--main__image').css({ 'transform-origin': ((e.pageX - $(this).offset().left) / $(this).width()) * 100 + '% ' + ((e.pageY - $(this).offset().top) / $(this).height()) * 100 + '%' });
                })
                // tiles set up
                .each(function () {
                    $(this)
                        // add a image container
                        .append('<div class="product-img--main__image"></div>')
                        // set up a background image for each tile based on data-image attribute
                        .children('.product-img--main__image').css({ 'background-image': 'url(' + $(this).attr('data-image') + ')' });
                })
        // // </script>
    <%- include('../partials/customer/footer.ejs') %>